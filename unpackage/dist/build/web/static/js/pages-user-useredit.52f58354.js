(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-useredit"],{"24f0":function(t,e,a){"use strict";a.r(e);var n=a("2769"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},2769:function(t,e,a){"use strict";a("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("ac1f"),a("00b4"),a("e9c4");var n=a("625a"),i=a("bfa7"),o={data:function(){return{StatusBar:this.StatusBar,CustomBar:this.CustomBar,NavBar:this.StatusBar+this.CustomBar,AppStyle:this.$store.state.AppStyle,uid:0,name:"",screenName:"",password:"",repassword:"",mail:"",phone:"",url:"",avatar:"",avatarNew:"",introduce:"",modalName:null,token:"",styleIndex:""}},onPullDownRefresh:function(){},onShow:function(){if(this.userStatus(),n.localStorage.getItem("toAvatar")){var t=JSON.parse(n.localStorage.getItem("toAvatar"));this.avatarUpload(t.dataUrl)}else console.log("没有头像缓存")},onLoad:function(){},methods:{back:function(){uni.navigateBack({delta:1})},showModal:function(t){this.modalName=t.currentTarget.dataset.target},hideModal:function(t){this.modalName=null},validatePassword:function(t){return/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/.test(t)},userStatus:function(){var t=this,e="";if(n.localStorage.getItem("userinfo")){var a=JSON.parse(n.localStorage.getItem("userinfo"));e=a.token}t.$Net.request({url:t.$API.userStatus(),data:{token:e},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",dataType:"json",success:function(e){if(1==e.data.code&&(t.uid=e.data.data.uid,t.screenName=e.data.data.screenName,t.name=e.data.data.name,t.mail=e.data.data.mail,t.url=e.data.data.url,t.token=e.data.data.token,t.avatar=e.data.data.avatar,t.introduce=e.data.data.introduce,t.phone=e.data.data.phone,n.localStorage.getItem("userinfo"))){var a=JSON.parse(n.localStorage.getItem("userinfo"));a.screenName?t.screenName=a.screenName:t.screenName=a.name,e.data.data.customize&&(a.customize=e.data.data.customize),e.data.data.lv&&(a.lv=e.data.data.lv),e.data.data.isvip&&(a.isvip=e.data.data.isvip),e.data.data.vip&&(a.vip=e.data.data.vip),e.data.data.experience&&(a.experience=e.data.data.experience),n.localStorage.setItem("userinfo",JSON.stringify(a))}},fail:function(t){uni.showToast({title:"网络开小差了哦",icon:"none"})}})},validateString:function(t){return!/\s|　/.test(t)&&!/^\s+$/.test(t)},userEdit:function(){var t=this,e="";if(n.localStorage.getItem("userinfo")){var a=JSON.parse(n.localStorage.getItem("userinfo"));e=a.token}if(""!=t.password){if(!t.validatePassword(t.password))return uni.showToast({title:"密码必须包含字母、数字和特殊符号，且长度必须大于8",icon:"none",duration:1e3,position:"bottom"}),!1;if(t.password!=t.repassword)return uni.showToast({title:"两次密码不一致",icon:"none",duration:1e3,position:"bottom"}),!1}if(t.isValidString(t.screenName))return uni.showToast({title:"昵称不能包含空格",icon:"none",duration:1e3,position:"bottom"}),!1;var i={uid:t.uid,name:t.name,screenName:t.screenName,password:t.password,introduce:t.introduce,url:t.url};""!=t.avatarNew&&(i.avatar=t.avatarNew),uni.showLoading({title:"加载中"}),t.$Net.request({url:t.$API.userEdit(),data:{params:JSON.stringify(t.$API.removeObjectEmptyKey(i)),token:e},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",dataType:"json",success:function(e){if(setTimeout((function(){uni.hideLoading()}),1e3),uni.showToast({title:e.data.msg,icon:"none"}),1==e.data.code)if(""!=t.password){n.localStorage.removeItem("userinfo"),n.localStorage.removeItem("token");setTimeout((function(){var e=t.styleIndex;uni.redirectTo({url:"/pages/home/"+e}),clearTimeout("timer")}),1e3)}else{var a=JSON.parse(n.localStorage.getItem("userinfo"));a.screenName=t.screenName,a.url=t.url,a.introduce=t.introduce,""!=t.avatarNew&&(a.avatar=t.avatarNew),t.avatarNew="",n.localStorage.setItem("userinfo",JSON.stringify(a))}},fail:function(t){setTimeout((function(){uni.hideLoading()}),1e3),uni.showToast({title:"网络开小差了哦",icon:"none"}),uni.stopPullDownRefresh()}})},toEmail:function(){uni.navigateTo({url:"/pages/user/mailedit"})},toAddress:function(){uni.navigateTo({url:"/pages/user/address"})},toPay:function(){uni.navigateTo({url:"/pages/user/pay"})},toBg:function(){uni.navigateTo({url:"/pages/user/userBg"})},toBind:function(){uni.navigateTo({url:"/pages/user/userbind"})},toGravatar:function(){this.hideModal();window.open("https://cn.gravatar.com/")},toAvatar:function(){uni.navigateTo({url:"../../uni_modules/buuug7-img-cropper/pages/cropper",events:{imgCropped:function(t){console.log(t)}}})},avatarUpload:function(t){var e=this,a="";if(n.localStorage.getItem("userinfo")){var o=JSON.parse(n.localStorage.getItem("userinfo"));a=o.token}(0,i.base64ToPath)(t).then((function(t){var i=t;uni.uploadFile({url:e.$API.upload(),filePath:i,name:"file",formData:{token:a},success:function(t){setTimeout((function(){uni.hideLoading()}),1e3);var a=JSON.parse(t.data);1==a.code?(e.avatar=a.data.url,e.avatarNew=a.data.url,n.localStorage.removeItem("toAvatar"),e.userEdit()):uni.showToast({title:"头像上传失败，请检查接口",icon:"none"})},fail:function(){setTimeout((function(){uni.hideLoading()}),1e3)}})})).catch((function(t){console.error("失败"+t)}))},isValidString:function(t){return/\s/g.test(t)}}};e.default=o},9600:function(t,e,a){"use strict";a.r(e);var n=a("c729"),i=a("24f0");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);var s=a("f0c5"),r=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"0f4da3e3",null,!1,n["a"],void 0);e["default"]=r.exports},bfa7:function(t,e,a){"use strict";a("7a82");var n=a("ee27").default;Object.defineProperty(e,"__esModule",{value:!0}),e.base64ToPath=function(t){return new Promise((function(e,a){if("object"===("undefined"===typeof window?"undefined":(0,i.default)(window))&&"document"in window){t=t.split(",");var n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),u=r.length,c=new Uint8Array(u);while(u--)c[u]=r.charCodeAt(u);return e((window.URL||window.webkitURL).createObjectURL(new Blob([c],{type:n})))}var l=t.split(",")[0].match(/data\:\S+\/(\S+);/);l?l=l[1]:a(new Error("base64 error"));var d=function(){return Date.now()+String(s++)}()+"."+l;if("object"!==("undefined"===typeof plus?"undefined":(0,i.default)(plus)))if("object"===("undefined"===typeof wx?"undefined":(0,i.default)(wx))&&wx.canIUse("getFileSystemManager")){v=wx.env.USER_DATA_PATH+"/"+d;wx.getFileSystemManager().writeFile({filePath:v,data:o(t),encoding:"base64",success:function(){e(v)},fail:function(t){a(t)}})}else a(new Error("not support"));else{var v="_doc/uniapp_temp/"+d;if(!function(t,e){for(var a=t.split("."),n=e.split("."),i=!1,o=0;o<n.length;o++){var s=a[o]-n[o];if(0!==s){i=s>0;break}}return i}("Android"===plus.os.name?"1.9.9.80627":"1.9.9.80472",plus.runtime.innerVersion))return void plus.io.resolveLocalFileSystemURL("_doc",(function(n){n.getDirectory("uniapp_temp",{create:!0,exclusive:!1},(function(n){n.getFile(d,{create:!0,exclusive:!1},(function(n){n.createWriter((function(n){n.onwrite=function(){e(v)},n.onerror=a,n.seek(0),n.writeAsBinary(o(t))}),a)}),a)}),a)}),a);var f=new plus.nativeObj.Bitmap(d);f.loadBase64Data(t,(function(){f.save(v,{},(function(){f.clear(),e(v)}),(function(t){f.clear(),a(t)}))}),(function(t){f.clear(),a(t)}))}}))},e.pathToBase64=function(t){return new Promise((function(e,a){if("object"===("undefined"===typeof window?"undefined":(0,i.default)(window))&&"document"in window){if("function"===typeof FileReader){var n=new XMLHttpRequest;return n.open("GET",t,!0),n.responseType="blob",n.onload=function(){if(200===this.status){var t=new FileReader;t.onload=function(t){e(t.target.result)},t.onerror=a,t.readAsDataURL(this.response)}},n.onerror=a,void n.send()}var o=document.createElement("canvas"),s=o.getContext("2d"),r=new Image;return r.onload=function(){o.width=r.width,o.height=r.height,s.drawImage(r,0,0),e(o.toDataURL()),o.height=o.width=0},r.onerror=a,void(r.src=t)}"object"!==("undefined"===typeof plus?"undefined":(0,i.default)(plus))?"object"===("undefined"===typeof wx?"undefined":(0,i.default)(wx))&&wx.canIUse("getFileSystemManager")?wx.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:function(t){e("data:image/png;base64,"+t.data)},fail:function(t){a(t)}}):a(new Error("not support")):plus.io.resolveLocalFileSystemURL(function(t){if(0===t.indexOf("_www")||0===t.indexOf("_doc")||0===t.indexOf("_documents")||0===t.indexOf("_downloads"))return t;if(0===t.indexOf("file://"))return t;if(0===t.indexOf("/storage/emulated/0/"))return t;if(0===t.indexOf("/")){var e=plus.io.convertAbsoluteFileSystem(t);if(e!==t)return e;t=t.substr(1)}return"_www/"+t}(t),(function(t){t.file((function(t){var n=new plus.io.FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){a(t)},n.readAsDataURL(t)}),(function(t){a(t)}))}),(function(t){a(t)}))}))};var i=n(a("0122"));function o(t){var e=t.split(",");return e[e.length-1]}a("c975"),a("d3b7"),a("d9e2"),a("d401"),a("ac1f"),a("466d"),a("81b2"),a("0eb6"),a("b7ef"),a("8bd4"),a("ace4"),a("5cc6"),a("907a"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("986a"),a("1d02"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("b39a"),a("72f7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861");var s=0},c729:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"user",class:t.$store.state.AppStyle},[a("v-uni-view",{staticClass:"header",style:[{height:t.CustomBar+"px"}]},[a("v-uni-view",{staticClass:"cu-bar bg-white",style:{height:t.CustomBar+"px","padding-top":t.StatusBar+"px"}},[a("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.back.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-back"})],1),a("v-uni-view",{staticClass:"content text-bold",style:[{top:t.StatusBar+"px"}]},[t._v("个人设置")]),a("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.userEdit.apply(void 0,arguments)}}},[a("v-uni-button",{staticClass:"cu-btn round bg-blue"},[t._v("保存")])],1)],1)],1),a("v-uni-view",{style:[{padding:t.NavBar+"px 10px 0px 10px"}]}),a("v-uni-form",[a("v-uni-view",{staticClass:"user-edit-header margin-top"},[a("v-uni-image",{attrs:{src:t.avatar}}),a("v-uni-text",{staticClass:"cu-btn bg-gradual-blue radius",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toAvatar.apply(void 0,arguments)}}},[t._v("设置头像")])],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"title"},[t._v("用户名")]),a("v-uni-input",{attrs:{name:"input",disabled:"disabled",value:t.name}})],1),a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[t._v("昵称")]),a("v-uni-input",{attrs:{placeholder:"请输入昵称",name:"input"},model:{value:t.screenName,callback:function(e){t.screenName=e},expression:"screenName"}})],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"title"},[t._v("邮箱")]),a("v-uni-input",{attrs:{placeholder:"未设置",disabled:"disabled",name:"input",value:t.mail}}),a("v-uni-view",{staticClass:"text-blue",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toEmail.apply(void 0,arguments)}}},[t._v("修改")])],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"title"},[t._v("网址")]),a("v-uni-input",{attrs:{placeholder:"请输入网址",name:"input"},model:{value:t.url,callback:function(e){t.url=e},expression:"url"}})],1),a("v-uni-view",{staticClass:"cu-form-group align-start"},[a("v-uni-view",{staticClass:"title"},[t._v("个人简介")]),a("v-uni-textarea",{attrs:{placeholder:"输入个人简介"},model:{value:t.introduce,callback:function(e){t.introduce=e},expression:"introduce"}})],1),a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[t._v("密码")]),a("v-uni-input",{attrs:{placeholder:"请输入密码,不填则不修改",name:"input"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"title"},[t._v("确认密码")]),a("v-uni-input",{attrs:{placeholder:"请再次输入密码",name:"input"},model:{value:t.repassword,callback:function(e){t.repassword=e},expression:"repassword"}})],1)],1),a("v-uni-view",{staticClass:"cu-list menu"},[a("v-uni-view",{staticClass:"cu-item margin-top",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toBg.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"content"},[a("v-uni-text",[t._v("主页背景图")])],1),a("v-uni-view",{staticClass:"action"},[a("v-uni-text",{staticClass:"cuIcon-right"})],1)],1),a("v-uni-view",{staticClass:"cu-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toBind.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"content"},[a("v-uni-text",[t._v("社会化登陆绑定")])],1),a("v-uni-view",{staticClass:"action"},[a("v-uni-text",{staticClass:"cuIcon-right"})],1)],1),a("v-uni-view",{staticClass:"cu-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toAddress.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"content"},[a("v-uni-text",[t._v("收货地址设置")])],1),a("v-uni-view",{staticClass:"action"},[a("v-uni-text",{staticClass:"cuIcon-right"})],1)],1),a("v-uni-view",{staticClass:"cu-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toPay.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"content"},[a("v-uni-text",[t._v("账户设置")])],1),a("v-uni-view",{staticClass:"action"},[a("v-uni-text",{staticClass:"cuIcon-right"})],1)],1)],1),a("v-uni-view",{staticClass:"cu-modal",class:"DialogModal1"==t.modalName?"show":""},[a("v-uni-view",{staticClass:"cu-dialog"},[a("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[a("v-uni-view",{staticClass:"content"},[t._v("设置头像")]),a("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideModal.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-close text-red"})],1)],1),a("v-uni-view",{staticClass:"padding-xl text-left"},[a("v-uni-view",[t._v("Gravatar是全球最大的头像库，属于Wordpress旗下。它广泛应用于国内外各类网站和程序，包括知名的Github。在Gravatar通过您的邮箱注册用户，并设置头像后，您在所有支持Gravatar的网站使用邮箱，都会显示您的头像。")]),a("v-uni-view",[t._v("或者，您可以将将邮箱设置成QQ邮箱，将自动获取您的QQ头像。")])],1),a("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[a("v-uni-view",{staticClass:"action"},[a("v-uni-button",{staticClass:"cu-btn bg-green margin-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toGravatar.apply(void 0,arguments)}}},[t._v("前往Gravatar")])],1)],1)],1)],1)],1)},i=[]}}]);