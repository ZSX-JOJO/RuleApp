(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-inbox-home"],{"200f":function(t,a,e){"use strict";e.r(a);var i=e("3bd3"),s=e.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){e.d(a,t,(function(){return i[t]}))}(n);a["default"]=s.a},"3bd3":function(t,a,e){"use strict";e("7a82");var i=e("ee27").default;Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,e("e25e"),e("fb6a"),e("ac1f"),e("5319"),e("99af"),e("e9c4");var s=e("625a"),n=i(e("74ee")),o=(i(e("634b")),{data:function(){return{StatusBar:this.StatusBar,CustomBar:this.CustomBar,NavBar:this.StatusBar+this.CustomBar,AppStyle:this.$store.state.AppStyle,isLoading:0,chatList:[],page:1,msgLoading:null,uid:0,token:"",unreadData:{chat:0,comment:0,fan:0,finance:0,system:0,total:0}}},onPullDownRefresh:function(){clearInterval(this.msgLoading),this.msgLoading=null,this.page=1,this.getMyChat(!1),setTimeout((function(){uni.stopPullDownRefresh()}),1e3)},onBackPress:function(){clearInterval(this.msgLoading),this.msgLoading=null},onUnload:function(){clearInterval(this.msgLoading),this.msgLoading=null},onReachBottom:function(){},onShow:function(){var t=this;if(t.page=1,s.localStorage.getItem("userinfo")){var a=JSON.parse(s.localStorage.getItem("userinfo"));t.uid=a.uid}s.localStorage.getItem("token")&&(t.token=s.localStorage.getItem("token"),t.msgLoading=setInterval((function(){t.getMyChat(!1)}),3e3)),t.unreadNum()},onLoad:function(){},methods:{back:function(){clearInterval(this.msgLoading),this.msgLoading=null,uni.navigateBack({delta:1})},loadMore:function(){0==this.isLoad&&(this.moreText="正在加载中...",this.getMyChat(!0))},setRead:function(){var t=this;t.$Net.request({url:t.$API.setRead(),data:{token:t.token},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",dataType:"json",success:function(a){if(1==a.data.code){uni.showToast({title:"操作成功！",icon:"none"}),s.localStorage.setItem("noticeSum",0);var e=t.chatList;for(var i in e)e[i].myUnRead=0,e[i].otherUnRead=0;t.chatList=e}},fail:function(t){uni.showToast({title:"网络开小差了哦",icon:"none"})}})},chatFormatDate:function(t){t=new Date(parseInt(1e3*t));var a=t.getFullYear(),e=("0"+(t.getMonth()+1)).slice(-2),i=("0"+t.getDate()).slice(-2),s=("0"+t.getHours()).slice(-2),n=("0"+t.getMinutes()).slice(-2),o=s+":"+n,u=new Date,c=u.getFullYear(),l=(("0"+(u.getMonth()+1)).slice(-2),("0"+u.getDate()).slice(-2));return o=a==c&&a==c&&i==l?s+":"+n:e+"-"+i,o},replaceSpecialChar:function(t){return!!t&&(t=t.replace(/&quot;/g,'"'),t=t.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&nbsp;/g," "),t)},getMyChat:function(t){var a=this,e=a.page;if(t&&e++,""==a.token)return uni.showToast({title:"请先登录",icon:"none",duration:1e3,position:"bottom"}),!1;a.$Net.request({url:a.$API.myChat(),data:{token:a.token,limit:30,page:e,order:"lastTime"},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",dataType:"json",success:function(e){if(a.isLoading=1,a.isLoad=0,1==e.data.code){var i=e.data.data;if(i.length>0){var s=i;t?(a.page++,a.chatList=a.chatList.concat(s)):a.chatList=s}else a.moreText="没有更多消息了"}setTimeout((function(){a.isLoading=1,clearTimeout("timer")}),300)},fail:function(t){a.isLoad=0,a.isLoading=1,a.moreText="加载更多";setTimeout((function(){a.isLoading=1,clearTimeout("timer")}),300)}})},goChat:function(t){clearInterval(this.msgLoading),this.msgLoading=null;var a=t.id,e=this.chatList;for(var i in e)e[i].id==a&&(e[i].isNew=0,e[i].unRead=0);this.chatList=e,this.oldChatList=e,s.localStorage.setItem("chatList",JSON.stringify(e));var n=t.userJson.name,o=t.userJson.uid;clearInterval(this.msgLoading),this.msgLoading=null,uni.navigateTo({url:"/pages/chat/chat?uid="+o+"&name="+n+"&chatid="+a})},goPage:function(t){uni.navigateTo({url:t})},unreadNum:function(){var t=this,a="";if(s.localStorage.getItem("userinfo")){var e=JSON.parse(s.localStorage.getItem("userinfo"));a=e.token}t.$Net.request({url:t.$API.unreadNum(),data:{token:a},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",dataType:"json",success:function(a){1==a.data.code&&(t.unreadData=a.data.data)},fail:function(t){uni.showToast({title:"网络开小差了哦",icon:"none"})}})}},components:{waves:n.default}});a.default=o},6498:function(t,a,e){"use strict";e.d(a,"b",(function(){return i})),e.d(a,"c",(function(){return s})),e.d(a,"a",(function(){}));var i=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("v-uni-view",{class:t.$store.state.AppStyle},[i("v-uni-view",{staticClass:"header",style:[{height:t.CustomBar+"px"}]},[i("v-uni-view",{staticClass:"cu-bar bg-white",style:{height:t.CustomBar+"px","padding-top":t.StatusBar+"px"}},[i("v-uni-view",{staticClass:"action",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.back.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"cuIcon-back"})],1),i("v-uni-view",{staticClass:"content text-bold",style:[{top:t.StatusBar+"px"}]},[t._v("消息中心")]),i("v-uni-view",{staticClass:"action"},[i("v-uni-text",{staticClass:"text-blue",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.setRead()}}},[t._v("全部已读")])],1)],1)],1),i("v-uni-view",{style:[{padding:t.NavBar+"px 10px 0px 10px"}]}),i("v-uni-view",{staticClass:"data-box"},[i("v-uni-view",{staticClass:"index-sort grid col-4 inbox-sort"},[i("v-uni-view",{staticClass:"index-sort-box"},[i("waves",{attrs:{itemClass:"butclass"}},[i("v-uni-view",{staticClass:"index-sort-main",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goPage("/pages/user/fanList?uid="+t.uid)}}},[i("v-uni-view",{staticClass:"index-sort-i",staticStyle:{"background-color":"#ec3333"}},[i("v-uni-text",{staticClass:"cuIcon-friendaddfill"}),t.unreadData.fan>0?i("v-uni-text",{staticClass:"unreadNum bg-red"},[t._v(t._s(t.unreadData.fan))]):t._e()],1),i("v-uni-view",{staticClass:"index-sort-text"},[t._v("粉丝")])],1)],1)],1),i("v-uni-view",{staticClass:"index-sort-box"},[i("waves",{attrs:{itemClass:"butclass"}},[i("v-uni-view",{staticClass:"index-sort-main",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goPage("/pages/inbox/message")}}},[i("v-uni-view",{staticClass:"index-sort-i",staticStyle:{"background-color":"#4b81ff"}},[i("v-uni-text",{staticClass:"cuIcon-markfill"}),t.unreadData.comment>0?i("v-uni-text",{staticClass:"unreadNum bg-red"},[t._v(t._s(t.unreadData.comment))]):t._e()],1),i("v-uni-view",{staticClass:"index-sort-text"},[t._v("评论")])],1)],1)],1),i("v-uni-view",{staticClass:"index-sort-box"},[i("waves",{attrs:{itemClass:"butclass"}},[i("v-uni-view",{staticClass:"index-sort-main",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goPage("/pages/inbox/message?type=finance")}}},[i("v-uni-view",{staticClass:"index-sort-i",staticStyle:{"background-color":"#009a00"}},[i("v-uni-text",{staticClass:"cuIcon-rechargefill"}),t.unreadData.finance>0?i("v-uni-text",{staticClass:"unreadNum bg-red"},[t._v(t._s(t.unreadData.finance))]):t._e()],1),i("v-uni-view",{staticClass:"index-sort-text"},[t._v("财务")])],1)],1)],1),i("v-uni-view",{staticClass:"index-sort-box"},[i("waves",{attrs:{itemClass:"butclass"}},[i("v-uni-view",{staticClass:"index-sort-main",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goPage("/pages/inbox/message?type=system")}}},[i("v-uni-view",{staticClass:"index-sort-i",staticStyle:{"background-color":"#ee460e"}},[i("v-uni-text",{staticClass:"cuIcon-noticefill"}),t.unreadData.system>0?i("v-uni-text",{staticClass:"unreadNum bg-red"},[t._v(t._s(t.unreadData.system))]):t._e()],1),i("v-uni-view",{staticClass:"index-sort-text"},[t._v("系统")])],1)],1)],1)],1),0==t.chatList.length?i("v-uni-view",{staticClass:"no-data"},[t._v("暂时没有消息")]):t._e(),t.chatList.length>0?i("v-uni-view",{staticClass:"cu-list menu-avatar"},[t._l(t.chatList,(function(a,e){return[i("v-uni-view",{key:e+"_0",staticClass:"cu-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goChat(a)}}},[i("v-uni-view",{staticClass:"cu-avatar round lg",style:"background-image:url("+a.userJson.avatar+");"}),i("v-uni-view",{staticClass:"content"},[i("v-uni-view",[i("v-uni-view",{staticClass:"text-cut"},[t._v(t._s(a.userJson.name))])],1),i("v-uni-view",{staticClass:"text-gray text-sm flex"},[i("v-uni-view",{staticClass:"text-cut"},[null!=a.lastMsg?[4!=a.lastMsg.type?[a.lastMsg.uid==t.uid?[t._v("我:")]:[t._v(t._s(a.userJson.name)+":")],0==a.lastMsg.type?[t._v(t._s(a.lastMsg.text))]:t._e(),1==a.lastMsg.type?[t._v("[图片]")]:t._e()]:["ban"==a.lastMsg.text?[a.lastMsg.uid==t.uid?[i("v-uni-text",{staticClass:"text-blue"},[t._v("[你屏蔽了对方]")])]:[i("v-uni-text",{staticClass:"text-blue"},[t._v("[对方屏蔽了你]")])]]:[a.lastMsg.uid==t.uid?[i("v-uni-text",{staticClass:"text-blue"},[t._v("[你解除了屏蔽]")])]:[i("v-uni-text",{staticClass:"text-blue"},[t._v("[对方解除了屏蔽]")])]]]]:[t._v("暂无消息")]],2)],1)],1),i("v-uni-view",{staticClass:"action"},[i("v-uni-view",{staticClass:"text-grey text-xs"},[t._v(t._s(t.chatFormatDate(a.lastTime)))]),null!=a.lastMsg?[a.uid==t.uid?[0==a.myUnRead?i("v-uni-view",{staticClass:"cu-tag sm",staticStyle:{background:"none"}},[t._v("")]):i("v-uni-view",{staticClass:"cu-tag round bg-red sm"},[t._v(t._s(a.myUnRead>99?"99+":a.myUnRead))])]:[0==a.otherUnRead?i("v-uni-view",{staticClass:"cu-tag sm",staticStyle:{background:"none"}},[t._v("")]):i("v-uni-view",{staticClass:"cu-tag round bg-red sm"},[t._v(t._s(a.otherUnRead>99?"99+":a.otherUnRead))])]]:[i("v-uni-view",{staticClass:"cu-tag sm",staticStyle:{background:"none"}},[t._v("")])]],2)],1)]}))],2):t._e()],1),0==t.isLoading?i("v-uni-view",{staticClass:"loading"},[i("v-uni-view",{staticClass:"loading-main"},[i("v-uni-image",{attrs:{src:e("14d6")}})],1)],1):t._e()],1)},s=[]},b548:function(t,a,e){"use strict";e.r(a);var i=e("6498"),s=e("200f");for(var n in s)["default"].indexOf(n)<0&&function(t){e.d(a,t,(function(){return s[t]}))}(n);var o=e("f0c5"),u=Object(o["a"])(s["default"],i["b"],i["c"],!1,null,"7365747a",null,!1,i["a"],void 0);a["default"]=u.exports}}]);